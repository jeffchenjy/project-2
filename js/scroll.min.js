(function($) {
    "use strict";
  
    $.scrollIt = function(options) {
      var settings = $.extend({
        upKey: 38,
        downKey: 40,
        easing: "linear",
        scrollTime: 600,
        activeClass: "active",
        onPageChange: null,
        topOffset: 0
      }, options);
  
      var currentIndex = 0;
      var lastIndex = $("[data-scroll-index]:last").attr("data-scroll-index");
  
      var scrollToIndex = function(index) {
        if (index < 0 || index > lastIndex) return;
        var scrollTop = $("[data-scroll-index=" + index + "]").offset().top + settings.topOffset + 1;
        $("html, body").animate({
          scrollTop: scrollTop
        }, settings.scrollTime, settings.easing);
      };
  
      var handleKeyDown = function(event) {
        var keyCode = event.which;
        if ($("html, body").is(":animated") && (keyCode === settings.upKey || keyCode === settings.downKey)) {
          return false;
        }
        if (keyCode === settings.upKey && currentIndex > 0) {
          scrollToIndex(currentIndex - 1);
          return false;
        } else if (keyCode === settings.downKey && currentIndex < lastIndex) {
          scrollToIndex(currentIndex + 1);
          return false;
        }
        return true;
      };
  
      var handlePageChange = function(index) {
        if (settings.onPageChange && index && currentIndex !== index) {
          settings.onPageChange(index);
        }
        currentIndex = index;
        $("[data-scroll-nav]").removeClass(settings.activeClass);
        $("[data-scroll-nav=" + index + "]").addClass(settings.activeClass);
      };
  
      var handleScroll = function() {
        var scrollTop = $(window).scrollTop();
        var $matchedElements = $("[data-scroll-index]").filter(function(index, element) {
          var elementTop = $(element).offset().top + settings.topOffset;
          var elementBottom = elementTop + $(element).outerHeight();
          return scrollTop >= elementTop && scrollTop < elementBottom;
        });
        var index = $matchedElements.first().attr("data-scroll-index");
        handlePageChange(index);
      };
  
      $(window).on("scroll", handleScroll).scroll();
      $(window).on("keydown", handleKeyDown);
      $("body").on("click", "[data-scroll-nav], [data-scroll-goto]", function(event) {
        event.preventDefault();
        var targetIndex = $(event.target).closest("[data-scroll-nav]").attr("data-scroll-nav") || $(event.target).closest("[data-scroll-goto]").attr("data-scroll-goto");
        scrollToIndex(parseInt(targetIndex));
      });
    };
  })(jQuery);
  